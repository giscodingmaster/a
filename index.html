
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø¤ÙŠØ© 2026 - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX in Browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #000015;
            color: white;
            transition: background-color 0.5s ease, color 0.5s ease;
            margin: 0;
            overflow-x: hidden;
        }
        .light-mode {
            background-color: #f0f4f8;
            color: #1a202c;
        }
        @keyframes text-flicker {
            0% { opacity: 0.8; text-shadow: 0 0 10px #a8edea; }
            50% { opacity: 1; text-shadow: 0 0 20px #fed6e3; }
            100% { opacity: 0.9; text-shadow: 0 0 15px #ffffff; }
        }
        .flicker { animation: text-flicker 4s infinite alternate; }
        .floating { animation: floating 4s ease-in-out infinite; }
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }
        .pulse { animation: pulse-glow 2.5s infinite; }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px rgba(0, 191, 255, 0.3), inset 0 0 15px rgba(0, 191, 255, 0.2); }
            50% { box-shadow: 0 0 20px rgba(137, 207, 240, 0.6), inset 0 0 25px rgba(137, 207, 240, 0.4); }
            100% { box-shadow: 0 0 10px rgba(0, 191, 255, 0.3), inset 0 0 15px rgba(0, 191, 255, 0.2); }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .light-mode ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.1); }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/database": "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"
      }
    }
    </script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';
        import { initializeApp } from 'firebase/app';
        import { getDatabase, ref, onValue, set } from 'firebase/database';

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyCCnPJLH1IYwUf1iv5nL52diHXXUlfosIA",
          authDomain: "issue-tracker-5d2a1.firebaseapp.com",
          databaseURL: "https://issue-tracker-5d2a1-default-rtdb.firebaseio.com",
          projectId: "issue-tracker-5d2a1",
          storageBucket: "issue-tracker-5d2a1.firebasestorage.app",
          messagingSenderId: "883603835871",
          appId: "1:883603835871:web:f3af7423d128feafa0926a",
          measurementId: "G-3KXLNXZW4N"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- CONSTANTS ---
        const INITIAL_ORG_DATA = {
          ceo: {
            id: 'ceo',
            role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…',
            name: 'Ø£/ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¹ÙˆØ§Ù…ÙŠ',
            description: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…: Ø£/ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¹ÙˆØ§Ù…ÙŠ - Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©',
            colorClass: 'bg-gradient-to-br from-[#483D8B] to-[#00008B]'
          },
          expert: {
            id: 'expert',
            role: 'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù… Ø®Ø¨ÙŠØ±',
            name: 'Ù…/ Ù…Ø­Ù…Ø¯ Ø¹Ø·ÙŠØ©',
            description: 'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù… Ø®Ø¨ÙŠØ±: Ù…/ Ù…Ø­Ù…Ø¯ Ø¹Ø·ÙŠØ© - Ù…Ø³Ø¤ÙˆÙ„ Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù… Ø³ÙŠØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†',
            colorClass: 'bg-gradient-to-br from-[#00CED1] to-[#20B2AA]'
          },
          assistant: {
            id: 'assistant',
            role: 'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯',
            name: 'Ù…/ Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­',
            description: 'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯: Ù…/ Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­ - Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±',
            colorClass: 'bg-gradient-to-br from-[#8A2BE2] to-[#4B0082]'
          },
          technical: {
            id: 'technical',
            role: 'Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„ÙÙ†ÙŠ',
            name: 'Ù…/ Ù…Ø­Ù…Ø¯ ÙƒÙ…Ø§Ù„',
            description: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ ÙˆØ§Ù„Ù…ÙƒØªØ¨ Ø§Ù„ÙÙ†ÙŠ: Ù…/ Ù…Ø­Ù…Ø¯ ÙƒÙ…Ø§Ù„',
            colorClass: 'bg-gradient-to-br from-[#4682B4] to-[#1E90FF]'
          },
          subManagers: [
            {
              id: 'sami',
              role: 'Ù…Ø¯ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯',
              name: 'Ø£/ Ø³Ø§Ù…ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¹Ø¨ÙˆØ¯',
              description: 'Ù…Ø¯ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯: Ø£/ Ø³Ø§Ù…ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¹Ø¨ÙˆØ¯ - ÙŠØ´Ø±Ù Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©',
              colorClass: 'bg-gradient-to-br from-[#3b82f6] to-[#2563eb]',
              regions: [
                { 
                  id: 'menofia', 
                  role: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©', 
                  name: 'Ø£/ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„', 
                  description: 'Ù…Ø¯ÙŠØ± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©: Ø£/ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„', 
                  colorClass: 'bg-gradient-to-br from-[#5F9EA0] to-[#008B8B]',
                  stats: { total: 120, egyptGas: 80, institution: 40, pcCount: 55 },
                  architecture: {
                    supervisor: 'Ø£/ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„',
                    dataEntry: { role: 'Ù…Ø´Ø±Ù Ø¥Ø¯Ø®Ø§Ù„', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    recordingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ ØªØ³Ø¬ÙŠÙ„ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    surveyingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ Ù…Ø³Ø§Ø­ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' }
                  }
                }
              ]
            },
            {
              id: 'hussein',
              role: 'Ù…Ø¯ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯',
              name: 'Ø£/ Ø­Ø³ÙŠÙ† Ø³Ø¹ÙŠØ¯',
              description: 'Ù…Ø¯ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯: Ø£/ Ø­Ø³ÙŠÙ† Ø³Ø¹ÙŠØ¯',
              colorClass: 'bg-gradient-to-br from-[#3b82f6] to-[#2563eb]',
              regions: [
                { 
                  id: 'eastnile', 
                  role: 'Ù…Ù†Ø·Ù‚Ø© Ø´Ø±Ù‚ Ø§Ù„Ù†ÙŠÙ„', 
                  name: 'Ø£/ ÙˆÙ„ÙŠØ¯ Ù…Ø­ÙŠ', 
                  colorClass: 'bg-gradient-to-br from-[#5F9EA0] to-[#008B8B]',
                  stats: { total: 200, egyptGas: 130, institution: 70, pcCount: 90 },
                  architecture: {
                    supervisor: 'Ø£/ ÙˆÙ„ÙŠØ¯ Ù…Ø­ÙŠ',
                    dataEntry: { role: 'Ù…Ø´Ø±Ù Ø¥Ø¯Ø®Ø§Ù„', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    recordingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ ØªØ³Ø¬ÙŠÙ„ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    surveyingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ Ù…Ø³Ø§Ø­ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' }
                  }
                },
                { 
                  id: 'gharbia', 
                  role: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©', 
                  name: 'Ø£/ Ù…Ø¬Ø¯ÙŠ ØµØ§Ù„Ø­', 
                  colorClass: 'bg-gradient-to-br from-[#5F9EA0] to-[#008B8B]',
                  stats: { total: 150, egyptGas: 100, institution: 50, pcCount: 65 },
                  architecture: {
                    supervisor: 'Ø£/ Ù…Ø¬Ø¯ÙŠ ØµØ§Ù„Ø­',
                    dataEntry: { role: 'Ù…Ø´Ø±Ù Ø¥Ø¯Ø®Ø§Ù„', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    recordingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ ØªØ³Ø¬ÙŠÙ„ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    surveyingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ Ù…Ø³Ø§Ø­ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' }
                  }
                }
              ]
            },
            {
              id: 'safwat',
              role: 'Ù…Ø¯ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯',
              name: 'Ø£/ ØµÙÙˆØª Ø¹ÙˆÙŠØ³',
              description: 'Ù…Ø¯ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯: Ø£/ ØµÙÙˆØª Ø¹ÙˆÙŠØ³',
              colorClass: 'bg-gradient-to-br from-[#3b82f6] to-[#2563eb]',
              regions: [
                { 
                  id: 'dakahlia', 
                  role: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©', 
                  name: 'Ø£/ Ù…Ø§Ø¬Ø¯ Ù…ÙˆØ³Ù‰', 
                  colorClass: 'bg-gradient-to-br from-[#5F9EA0] to-[#008B8B]',
                  stats: { total: 180, egyptGas: 120, institution: 60, pcCount: 80 },
                  architecture: {
                    supervisor: 'Ù…/ Ù…Ø§Ø¬Ø¯ Ù…ÙˆØ³Ù‰',
                    dataEntry: { role: 'Ù…Ø´Ø±Ù Ø¥Ø¯Ø®Ø§Ù„', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    recordingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ ØªØ³Ø¬ÙŠÙ„ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' },
                    surveyingUpload: { role: 'Ù…Ø´Ø±Ù Ø±ÙØ¹ Ù…Ø³Ø§Ø­ÙŠ', name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' }
                  }
                }
              ]
            }
          ]
        };

        // --- COMPONENTS ---

        const OrgNode = ({ manager, onClick, className = "", pulse = false, floating = false, compact = false }) => (
          <div 
            onClick={() => onClick && onClick(manager)}
            className={`
              org-node cursor-pointer rounded-2xl text-center shadow-lg border border-white/20 hover:scale-105 hover:border-white/50 transition-all duration-300
              ${manager.colorClass} ${pulse ? 'pulse' : ''} ${floating ? 'floating' : ''} ${className}
              ${compact ? 'p-2 min-w-[120px]' : 'p-4 min-w-[180px]'} flex flex-col items-center justify-center
            `}
            style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.37)' }}
          >
            <div className={`${compact ? 'text-xs' : 'text-sm'} font-bold text-white/80`}>{manager.role}</div>
            <div className={`${compact ? 'text-sm' : 'text-lg'} font-bold text-white mt-1 leading-tight`}>{manager.name}</div>
          </div>
        );

        const ArchitectureModal = ({ manager, onClose, onSave, theme }) => {
          const [localArch, setLocalArch] = useState(null);
          useEffect(() => { if (manager?.architecture) setLocalArch({ ...manager.architecture }); }, [manager]);
          if (!manager || !localArch) return null;

          const handlePersonnelChange = (field, value) => {
            setLocalArch(prev => ({ ...prev, [field]: { ...prev[field], name: value } }));
          };

          const isDark = theme === 'dark';

          return (
            <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
              <div className="absolute inset-0 bg-black/90 backdrop-blur-xl animate-in fade-in duration-300" onClick={onClose} />
              <div className={`relative w-full max-w-4xl overflow-hidden border rounded-[3rem] shadow-2xl p-0 animate-in zoom-in-95 slide-in-from-top-12 duration-500 ${isDark ? 'bg-slate-900/95 text-white border-white/10' : 'bg-white/95 text-slate-900 border-slate-200'}`}>
                <div className="p-8 md:p-12 relative z-10">
                  <header className="text-center mb-16">
                     <h2 className="text-4xl font-black bg-gradient-to-r from-white via-cyan-200 to-blue-400 bg-clip-text text-transparent">{manager.role}</h2>
                     <div className="h-1 w-24 bg-cyan-500/50 mx-auto mt-4 rounded-full" />
                  </header>
                  <div className="flex flex-col items-center gap-12">
                    <div className="relative">
                      <div className="px-10 py-6 bg-gradient-to-br from-indigo-600 to-blue-800 rounded-3xl text-center min-w-[280px]">
                        <div className="text-xs font-bold text-white/60 mb-1">Ù…Ø´Ø±Ù Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</div>
                        <div className="text-2xl font-black text-white">{localArch.supervisor}</div>
                      </div>
                      <div className="absolute left-1/2 -translate-x-1/2 top-full w-1 h-12 bg-cyan-500" />
                    </div>
                    <div className="relative w-full max-w-3xl">
                       <div className="absolute top-[-1px] left-1/2 -translate-x-1/2 w-full h-[2px] bg-cyan-500" />
                       <div className="grid grid-cols-1 md:grid-cols-3 gap-8 pt-12">
                          {['dataEntry', 'recordingUpload', 'surveyingUpload'].map((key) => (
                            <div key={key} className="relative flex flex-col items-center">
                               <div className="absolute top-[-48px] w-1 h-12 bg-cyan-500" />
                               <div className="group w-full p-6 rounded-3xl bg-slate-800 border border-white/10">
                                  <div className="text-[10px] font-bold text-white/50 mb-2">{localArch[key].role}</div>
                                  <input type="text" value={localArch[key].name} onChange={(e) => handlePersonnelChange(key, e.target.value)} className="bg-transparent text-lg font-bold text-white focus:outline-none w-full border-b border-white/10 focus:border-cyan-400 pb-1" />
                               </div>
                            </div>
                          ))}
                       </div>
                    </div>
                  </div>
                  <div className="mt-20 flex justify-center gap-4">
                    <button onClick={() => onSave(manager.id, localArch)} className="px-12 py-5 bg-cyan-600 hover:bg-cyan-500 text-white font-black rounded-full transition-all">Ø­ÙØ¸ Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ©</button>
                    <button onClick={onClose} className="px-12 py-5 bg-slate-700 hover:bg-slate-600 text-white font-black rounded-full transition-all">Ø¥ØºÙ„Ø§Ù‚</button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const RegionModal = ({ manager, onClose, onSave, onOpenArch, theme }) => {
          const [localStats, setLocalStats] = useState(null);
          useEffect(() => { if (manager?.stats) setLocalStats({ ...manager.stats }); }, [manager]);
          if (!manager || !localStats) return null;

          const handleChange = (field, value) => {
            setLocalStats(prev => ({ ...prev, [field]: parseInt(value) || 0 }));
          };

          const isDark = theme === 'dark';

          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
              <div className="absolute inset-0 bg-black/80 backdrop-blur-md" onClick={onClose} />
              <div className={`relative w-full max-w-lg overflow-hidden border rounded-[2.5rem] p-8 animate-in zoom-in-95 ${isDark ? 'bg-slate-900 text-white border-white/10' : 'bg-white text-slate-900 border-slate-200'}`}>
                <h2 className="text-3xl font-bold mb-6 text-center">{manager.role}</h2>
                <div className="space-y-4">
                  <div>
                    <label className="text-xs font-bold opacity-60">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯</label>
                    <input type="number" value={localStats.total} onChange={(e) => handleChange('total', e.target.value)} className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 border border-white/10 focus:border-cyan-400 outline-none" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="text-xs font-bold opacity-60">ØºØ§Ø² Ù…ØµØ±</label>
                      <input type="number" value={localStats.egyptGas} onChange={(e) => handleChange('egyptGas', e.target.value)} className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 border border-white/10 outline-none" />
                    </div>
                    <div>
                      <label className="text-xs font-bold opacity-60">Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</label>
                      <input type="number" value={localStats.institution} onChange={(e) => handleChange('institution', e.target.value)} className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 border border-white/10 outline-none" />
                    </div>
                  </div>
                  <div>
                    <label className="text-xs font-bold opacity-60">Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</label>
                    <input type="number" value={localStats.pcCount} onChange={(e) => handleChange('pcCount', e.target.value)} className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 border border-white/10 outline-none" />
                  </div>
                </div>
                <div className="mt-8 flex gap-4">
                  <button onClick={() => onSave(manager.id, localStats)} className="flex-1 py-4 bg-cyan-600 rounded-xl font-bold text-white">Ø­ÙØ¸</button>
                  <button onClick={() => onOpenArch(manager)} className="flex-1 py-4 bg-slate-700 rounded-xl font-bold text-white">Ø¹Ø±Ø¶ Ø§Ù„Ù‡ÙŠÙƒÙ„</button>
                </div>
              </div>
            </div>
          );
        };

        const App = () => {
          const [theme, setTheme] = useState('dark');
          const [orgData, setOrgData] = useState(INITIAL_ORG_DATA);
          const [loading, setLoading] = useState(true);
          const [selectedManager, setSelectedManager] = useState(null);
          const [archManager, setArchManager] = useState(null);

          useEffect(() => {
            const dataRef = ref(db, 'orgData');
            onValue(dataRef, (snapshot) => {
              const data = snapshot.val();
              if (data) setOrgData(data);
              else set(dataRef, INITIAL_ORG_DATA);
              setLoading(false);
            });
          }, []);

          const handleSaveStats = (id, newStats) => {
            const updated = { ...orgData };
            updated.subManagers = updated.subManagers.map(sub => ({
              ...sub, regions: sub.regions?.map(reg => reg.id === id ? { ...reg, stats: newStats } : reg)
            }));
            set(ref(db, 'orgData'), updated);
            setSelectedManager(null);
          };

          const handleSaveArch = (id, newArch) => {
            const updated = { ...orgData };
            updated.subManagers = updated.subManagers.map(sub => ({
              ...sub, regions: sub.regions?.map(reg => reg.id === id ? { ...reg, architecture: newArch } : reg)
            }));
            set(ref(db, 'orgData'), updated);
            setArchManager(null);
          };

          if (loading) return <div className="h-screen flex items-center justify-center bg-[#000015] text-cyan-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...</div>;

          const isDark = theme === 'dark';
          const lineClass = isDark ? 'border-white/20' : 'border-slate-300';
          const bgLineClass = isDark ? 'bg-white/20' : 'bg-slate-300';

          return (
            <div className={`min-h-screen relative p-8 ${theme === 'light' ? 'light-mode' : ''}`}>
              <button onClick={() => setTheme(t => t === 'dark' ? 'light' : 'dark')} className="fixed top-6 left-6 z-50 p-4 bg-white/10 rounded-full border border-white/20">{isDark ? 'ğŸŒ™' : 'â˜€ï¸'}</button>
              
              <RegionModal manager={selectedManager} onClose={() => setSelectedManager(null)} onSave={handleSaveStats} onOpenArch={(m) => { setSelectedManager(null); setArchManager(m); }} theme={theme} />
              <ArchitectureModal manager={archManager} onClose={() => setArchManager(null)} onSave={handleSaveArch} theme={theme} />

              <header className="text-center mb-16">
                <h1 className="text-5xl font-black mb-2 flicker">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h1>
                <div className="inline-block bg-cyan-500/20 px-6 py-1 rounded-full text-cyan-400 font-bold pulse">Ø±Ø¤ÙŠØ© 2026</div>
              </header>

              <div className="flex flex-col items-center gap-12 max-w-6xl mx-auto">
                <OrgNode manager={orgData.ceo} floating onClick={(m) => alert(m.description)} className="ring-4 ring-indigo-500/30" />
                
                <div className="relative w-full">
                  <div className={`absolute top-[-30px] left-1/2 -translate-x-1/2 w-[70%] h-[30px] border-x-2 border-t-2 rounded-t-3xl ${lineClass}`} />
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-12 pt-4 relative">
                    <div className="flex flex-col items-center relative">
                      <div className="flex items-start gap-4 flex-row-reverse">
                        <OrgNode manager={orgData.assistant} onClick={(m) => alert(m.description)} />
                        <div className="pt-10 flex flex-row-reverse items-center">
                          <div className={`w-8 h-[2px] ${bgLineClass}`} />
                          <OrgNode manager={orgData.technical} compact onClick={(m) => alert(m.description)} className="scale-90" />
                        </div>
                      </div>
                      <div className={`w-[2px] h-20 bg-gradient-to-b from-purple-500 to-transparent mt-4`} />
                    </div>
                    <div className="flex flex-col items-center">
                      <OrgNode manager={orgData.expert} onClick={(m) => alert(m.description)} />
                      <div className={`w-[2px] h-20 bg-gradient-to-b from-cyan-500 to-transparent mt-4`} />
                    </div>
                  </div>
                </div>

                <div className="relative w-full mt-[-20px]">
                  <div className={`absolute top-[-40px] left-1/2 -translate-x-1/2 w-[80%] h-[40px] border-x-2 border-t-2 rounded-t-3xl ${lineClass}`} />
                  <div className={`bg-white/5 backdrop-blur-xl border-2 border-green-500/30 rounded-3xl p-8 grid grid-cols-1 md:grid-cols-3 gap-8 ${!isDark ? 'bg-white/50' : ''}`}>
                    {orgData.subManagers.map((sub, idx) => (
                      <div key={sub.id} className="flex flex-col items-center">
                        <OrgNode manager={sub} />
                        <div className="mt-8 flex flex-wrap justify-center gap-3">
                          {sub.regions?.map(region => (
                            <OrgNode key={region.id} manager={region} compact onClick={setSelectedManager} className="scale-95 opacity-80 hover:opacity-100" />
                          ))}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
